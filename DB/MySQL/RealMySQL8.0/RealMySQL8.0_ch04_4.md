# RealMySQL8.0 ch04. 아키텍쳐
## 4.4 MySQL 로그 파일
### 4.4.1 에러 로그 파일
* MySQL 실행 도중의 에러와 경고 메세지가 출력되는 로그파일
* my.cnf의 log_error 파라미터의 경로에 에러 로그파일이 저장됨
  * 별도로 설정되지 않은 경우 데이터 디렉터리에 `.err` 확장자 파일로 저장된다

자주 보이는 에러 메세지
* MySQL이 시작하는 과정과 관련된 정보성 및 에러 메세지
  * 서버 정상 기동 : `mysqld: ready for connections`
  * 특정 변수가 무시된 경우 MySQL은 정상 기동되었지만 파라미터가 MySQL 서버에 적용디지 못했다는 뜻
* 마지막으로 종료할 때 비정상적으로 종료된 경우 나타나는 InnoDB 트랜잭션 복구 메세지
  * InnoDB는 비정상 종료 후 재시작 될 때 완료되지 못한 트랜잭션을 다시 기록하는 재처리 작업을 함. 
* 쿼리 처리 도중 발생하는 문제에 대한 에러 메세지
* 비정상적으로 종료된 커넥션 메세지(Aborted connection)
* InnoDB 모니터링 또는 상태조회명령(`SHOW ENGINE INNODB STATUS` )의 결과 메세지
* MySQL 종료 메세지

### 4.4.2 제너럴 쿼리 로그 파일(General log)
MySQL에서 실행되는 쿼리 전체를 뽑아서 검토해야 하는 경우, 제너럴 쿼리 로그를 활성화해서 로그 파일로 기록한 뒤 검토하면 된다. 
MySQL이 쿼리 요청을 받으면 바로 기록되며, 쿼리 실행 중 에러가 발생해도 로그 파일에 기록된다
* general_log_file 파라미터에 쿼리 로그 파일 경로 작성.

### 4.4.3 슬로우 쿼리 로그
* `long_query_time` 시스템 변수에 설정한 시간 이상의 시간이 소요된 쿼리가 작성됨
* 쿼리 실행 이후 실행 시간을 기준으로 기록되므로 반드시 성공한 쿼리만 저장됨.
* `log_outout` 옵션으로 슬로우 쿼리 기록할 테이블 선택 가능.

슬로우 쿼리 분석

<img width="525" alt="image" src="https://github.com/youngDaLee/TIL/assets/64643665/6283bf07-28b5-428b-8170-0b2de9563a77">

* `Time` : 쿼리가 종료된 시점(시작 시점은 Time 에서 Query_time만큼을 뺀 시간)
* `User@Host` : 쿼리를 실행한 사용자
* `Query_time` : 쿼리가 실행되는데 걸린 전체 시간
* `Lock_time` : 테이블 잠금 대기시간. 실제 쿼리가 실행하는데 필요한 잠금체크 같은 시간까지 포함되기 때문에 매우 작은값이면 무시해도 됨
  * MyISAM과 MEMORY 스토리지 엔진은 테이블 단위 락만 사용하고 MVCC 개념이 없어 Lock_time이 1초 이상 소요될 수 있는데, InnoDB에서 Lock_time 1초 이상이라는건 레코드 단위가 아니라 테이블 단위 잠금이 있었다는 것.
  * 튜닝이나 쿼리 분석에 도움 되는 값은 아님
* `Row_examined` : 쿼리가 처리되기 위해 몇 건의 레코드에 접근했는지. `Row_examined` 가 높은데 `Row_sent` 가 낮으면 튜닝 시도 할만 함

