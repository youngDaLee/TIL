# ch03 운영체제
## 3.1 운영체제와 컴퓨터
운영체제의 역할
1. CPU 스케줄링과 프로세스 관리 : CPU 소유권을 어떤 프로세스에 할당할지 프로세스 생성/삭제/자원할당/반환 을 관리함
2. 메모리 관리 : 한정된 메모리를 어떤 프로세스에 얼만큼 할당해야 하는지 관리
3. 디스크 파일 관리 : 디스크 파일을 어떤 방법으로 보관할지 관리
4. I/O 디바이스 관리 : I/O 디바이스들인 마우스,키보드와 컴퓨터간 데이터를 주고받는걸 관리

운영체제 구조
* GUI
  * 사용자가 전자장치와 상호작용 할 수 있도록 하는 사용자 인터페이스 형태. 단순 명령어창이 아니라 마우스 클릭 등으로 컴퓨터와 상호작용 할 수 있게 함
* 시스템콜
  * 운영체제가 커널에 접근하기 위한 인터페이스이며 유저 프로그램이 운영체제 서비스 받기 위해 커널 함수 호출할때 씀
  * modebit을 참고하여 유저모드와 커널모드 구분함
* 커널
  * 운영체제 핵심 부분... 시스템콜 인터페이스를 제공
  * 운영체제 중추적인 역할(보안, 메모리, 프로세스, 파일시스템, IO디바이스, IO요청 관리 등)
* 드라이버
  * 하드웨어를 제어하기 위한 SW

컴퓨터의 요소
* CPU
  * 산술논리연산장치, 제어장치, 레지스터로 구성되어 있는 컴퓨터 장치
  * 인터럽트에 의해 단순히 메모리에 존재하는 명령어를 해석해서 실행하는 일꾼
  * 제어장치 : 프로세스 조작을 지시하는 CPU 한 부품. 입출력장치간 통신을 제어하고 명령어 읽고 해석하며 데이터 처리를 위한 순서를 결정
  * 레지스터 : CPU 안의 매우 빠른 임시기억장치
  * 산술논리연산장치(ALU) : 덧셈, 뺄셈같은 숫자의 산술연산과 배타적 논리합, 논리곱같은 논리연산을 계산하는 디지털 회로
* DMA 컨트롤러
  * IO디바이스가 메모리에 직접접근할 수 있도록 하는 하드웨어 장치
  * CPU의 일을 부담하는 보조 일꾼
* 메모리
  * 전자회로에서 데이터나 상태, 명령어 등을 기록하는 장치
  * RAM을 일컬어 메모리라고도 함
* 타이머
  * 몇 초 안에는 작업이 끝나야 한다를 정의
* 디바이스 컨트롤러

## 3.2 메모리
메모리 계층
* 레지스터 : CPU안. 작음. 빠름. 기억용량 적음
* 캐시 : L1, L2 캐시 저장. 휘발성, 속도 빠름, 기억용량 적음
  * 데이터를 미리 복사해놓는 임시저장소
  * 빠른 장치와 느린 장치에서 속도 차이에 따른 병목 현상을 줄이기 위한 메모리
  * 캐시 메모리와 보조기억장치 사이에 있는 주기억장치를 캐싱계층이라 할 수 있음
  * 지영성의 원리
    * 시간지역성 : 최근 사용한 데이터에 다시 접근하려는 특성
    * 공간지역성 : 최근 접근한 데이터를 이루고 있는 공간이나, 가까운 공간에 접근하련느 특성
  * 캐시히트와 캐시미스 : 캐시에서 원하는 데이터를 찾은게 캐시히트, 캐시에 없어서 디스크에서 가져오는걸 캐시미스
  * 캐시매핑 : 캐시히트 되기 위해 매핑하는 방법
    * 직접매핑 : 처리가 빠르지만 충돌 발생
    * 연관매핑 : 순서를 일치시키지 않고 관련 캐시와 메모리 매핑. 충돌 적지만 느림
    * 집합연관매핑 : 직접매핑+연관매핑
  * 웹 브라우저 캐시 : 추후 서버 요청 시 자신을 나타내는 아이덴티티나 중복요청 방지용으로 사용
    * 쿠키 : 만료기간이 있는 키-값 저장소
    * 로컬 스토리지 : 만료기한이 없는 키-값 저장소. 10MB까지 저장가능, 웹 브라우저 닫아도 유지. HTML5 지원하는 웹브라우저에서 사용 가능
    * 세션 스토리지 : 만료기한이 없는 키-값 저장소. 탭 단위로 스토리지 생성하여 저장. 5MB, HTML5
* 주기억장치 : RAM. 휘발성, 속도 보통, 기억용량 보통
* 보조기억장치 : HDD, SSD. 휘발성, 속도 낮음, 기억용량 많음

메모리 관리
* 가상메모리
  * 컴퓨터가 이용 가능한 메모리 자원을 추상화하여 사용자들에게는 크게 보이게 하는 방법
  * 가상주소와 실제 주소가 매핑되어 있고, 페이지 테이블로 관리됨
  * 속도 향상을 위해 TLB를 씀 : TLB - 메모리와 CPU 사이의 주소 변환을 위한 캐시
  * 스와핑 : 현재 없는 데이터나 코드에 접근할 경우 페이지 폴트 발생. 사용하지 않는걸 디스크로 내리고, 사용하는걸 RAM으로 옮기는 과정을 스와핑이라고 함
  * 페이지 폴트 : 프로세스 주소 공간에는 존재하지만 RAM에 없는 데이터에 접근했을 경우 발생
* 스레싱
  * 메모리 페이지폴트율이 높은 것을 의미. 심각한 성능 저하...
  * 메모리에 너무 많은 프로세스가 동시에 올라가면 스와핑이 많이 일어나서 발생함
  * 작업세트 : 프로세스 과거 사용 이력인 지역성을 통해 결정된 페이지 집합을 만들어 메모리에 로드하는 것
  * PFF : 페이지 폴트 빈도를 조절하는 방법. 상한선과 하한선을 만드는 방법
* 메모리 할당
  * 연속 할당 : 메모리에 연속적으로 공간 할당하는 것
  * 고정분할방식 : 메모리를 미리 나누어 관리하는 방법. 융통성이 없고 내부 단편화 발생
  * 가변분할방식 : 매 시점 프로그램 크기에 맞게 동적으로 메모리 나눠 사용. 내부단편화는 없지만 외부단편화 발생 가능
    * 최초적합 : 순차적으로 보며 홀을 찾으면 바로 할당
    * 최적적합 : 프로세스 크기 이상인 공간 중 가장 작은 홀부터 할당
    * 최악적합 : 프로세스 크기와 가장 많이 차이나는 홀에 할당
  * 외부단편화 : 메모리를 나눈 크기보다 프로그램이 커서 들어가지 못하는 공간이 많이 발생하는 현상
  * 내부단편화 : 메모리를 나눈 크기보다 프로그램이 작아서 들어가지 못하는 공간이 많이 발생하는 현상
* 불연속할당 : 메모리를 연속적으로 할당하지 않는 것.
  * 페이징 : 동일한 크기의 페이지 단위로 나누어 메모리의 서로 다른 위치에 프로세스를 할당.
  * 세그맨테이션 : 페이지 단위가 아닌 의미 단위의 세그먼트로 나눈 방식
  * 페이지드 세그맨테이션 : 공유나 보안을 의미 단위의 세그먼트로 나누고, 물리적 메모리는 페이지로 나누는것

페이지 교체 알고리즘
* 오프라인 알고리즘 : 먼 미래에 참조되는 페이지와 현재 페이지를 바꾸는 알고리즘 -> 먼 지래에 사용되는 프로세스를 알 수 없기때문에 불가
* FIFO : 가장 먼저 온 페이지를 교체 영역에 가장 먼저 놓는 방법
* LRU : 참조가 오래된 페이지를 바꿈. 오래된걸 파악하기 위해 페이지마다 계수기, 스택을 두어야 하는 문제점..
  * 해시테이블과 이중연결리스트로 구현
* NUR : clock 알고리즘
* LFU : 가장 참조 횟수가 적은 페이지를 교체. 많이 사용하지 않은 것을 교체

## 3.3 프로세스와 스레드
프로세스와 컴파일 과정
* 프로세스 : 프로그램으로부터 인스턴스화 된 것
* 프로그램 : 컴파일 과정을 거쳐 컴퓨터가 이해할 수 있는 기계어로 번역되어 실행될 수 있는 파일이 된느 것.
* 전처리
  * 소스코드 주석 제거하고 #include 등 헤더파일 병합하여 매크로로 치환
* 컴파일러
  * 오류처리, 코드 최적화, 어셈블리어로 변환
* 어셈블러
  * 목적코드로 변환
* 링커
  * 프로그램내 라이브러리 함수 또는 다른 파일들과 목적코드 결합하여 실행파일 만듬

프로세스 상태
* 생성상태(created)
  * fork() exec()로 생성된 상태. 이때 PCB가 할당됨
  * fork : 부모 프로세스 주소 공간 그대로 복사해서 자식프로세스 생성하는 함수. 주소 공간만 복사하고 부모프로세스 비동기 작업 상속하지는 않음
  * exec : 새롭게 프로세스 생성
* 대기상태(ready)
  * 메모리 공간 충분하면 메모리 할당받고 아니면 아닌 상태로 대기.
  * CPU 스케줄러로부터 CPU 소유권 넘어오기를 기다리는 상태
* 대기중단상태(ready suspended)
  * 메모리 부족으로 일시중단된 상태
* 실행상태(running)
  * CPU 소유권, 메모리 할당받아 수행중인 상태
* 중단상태
  * 이벤트 발생 이후 프로세스 차단된 상태
* 일시중단 상태
  * 대기 중단과 비슷한 상태. 중단된 상태에서 프로세스 실행되려고 했지만 메모리 부족으로 일시 중단된 상태
* 종료 상태
  * CPU 소유권 모두 놓고 가는 상태

프로세스의 메모리 구조
* 스택
  * 지역변수, 매개변수, 함수 저장되고 컴파일 시에 크기 결정되며 동적인 특징 가짐
  * 함수가 함수를 재귀적으로 호출하면서 동적으로 크기가 늘어날 수 있음
  * 핍과 스택 메모리 영역이 겹치면 안되기 때문에 힙과 스택 사이 공간 비워둠
* 힙
  * 동적 할당때 사용됨. 런타임때 크기가 결정됨
* 데이터영역
  * 전역변수, 정적변수가 저장됨.
  * BSS 영역과 Data 영역으로 바뀌고, BSS 영역은 초기화 되지 않은 변수가 0으로 초기화되어 저장되고 Data영역은 0이 아닌 다른 값으로 할당된 변수들이 저장됨
* 코드영역
  * 프로그램에 내장되어 있는 소스코드가 들어가는 여역
  * 수정불가한 기계어로 저장되어 있으며 정적인 특징 가짐

PCB
* 프로세스 메타데이터
* 프로세스가 생성되면 운영체제는 PCB를 생성

## 3.4 CPU 스케줄링 알고리즘
